<meta charset="utf-8">
<head>
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.12.4/jquery.min.js"></script>
  <script src="https://d3js.org/d3.v3.min.js"></script>
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css">
  <link rel="stylesheet" type="text/css" href="style.css">
  <title>US Election Trends</title>
</head>
<body>
  <h1>US Election Trends</h1>
  <div id="visualizations">
    <div id="options">options here</div>
    <div id="summary">summary visualization here</div>
    <div id="map">map here</div>
    <div id="polls">polls here</div>
  </div>
  <script>
    var exitPollsData;
    var categoriesDesc = [];
    d3.json("ExitPolls.json", function (data) {
      this.exitPollsData = data;
      //Get the category descriptions which are existed in 2016 data.
      data.data[11].results.forEach(function (d) {
        if (d.web_title != "")
          categoriesDesc[d.code] = d.web_title
        else if (d.question != "")
          categoriesDesc[d.code] = d.question
        else if (d.code != "")
          categoriesDesc[d.code] = d.code

        d.exit_poll_subcategories.forEach(function (e) {
          categoriesDesc[e.code] = e.answer

        });
      })

      this.exitPollsData.data.forEach(function (d) {
        d.results.forEach(function (res) {
          res.desc = categoriesDesc[res.code];
          res.exit_poll_subcategories.forEach(function (sub) {
            sub.desc = categoriesDesc[sub.code]
          });
        });
      });
      console.log("exitPollsData");
      console.log(exitPollsData);
    });
    //
    //
    
    //Map SVG
    var dimen = 13;
     var margin = {top: 20, right: 20, bottom: 80, left: 20},
            width = $('#map').width() - margin.left - margin.right,
            height = $('#map').height() - margin.top - margin.bottom

    var svgContainer = d3.select("#map").append("svg")
            .attr("width", width + margin.left + margin.right)
            .attr("height", height + margin.top + margin.bottom) //height + margin.top + margin.bottom
            .append("g")
           // .attr("transform", "translate(" + margin.left + "," + margin.top + ")");
    var x = d3.scale.linear()
            .domain([0,730])
            .range([0, width])

    var y = d3.scale.linear()
            .domain([0, 390])
            .range([0, height]);

    d3.json("states.json", function (data) {
      console.log(data);
      var rect = svgContainer.selectAll("rect")
              .data(data)
              .enter()
              .append("rect")
              .attr("fill", function (d) {
                if (d.estimation_2012 == -2 || d.estimation_2012 == -1) {
                  return "#B43030"
                }
                else
                  return "#405695"
              })
              .attr("x", function (d) {
                return x(d.x);
              })
              .attr("y", function (d) {
                return y(d.y);
              })
              .attr("width", function (d) {
                return Math.sqrt(d.noof_electrols) * dimen
              })
              .attr("height", function (d) {
                return Math.sqrt(d.noof_electrols) * dimen
              })
              .text("hello");

      var rect = svgContainer.selectAll(".statename")
             .data(data)
             .enter()
             .append("text")
             .attr("class", "statename")
             .attr("x", function (d) {
               return x(d.x)  + (Math.sqrt(d.noof_electrols) * dimen / 2)
             })
             .attr("y", function (d) {
               return y(d.y)  + (Math.sqrt(d.noof_electrols) * dimen / 2)
             })
            .attr("text-anchor", "middle")
            .style("font-size", function (d) {
              return Math.max(Math.sqrt(d.noof_electrols) * 3, 8)
            })
        .style("fill", "#FFF")
             .text(function (d) {
               return d.postal.substring(0,2);
             });

       
    });


  </script>
</body>
